var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),App=function(){function t(){}return t.whith=768,t.hight=896,t.hightScore=0,t.pipeNum=3,t}();__reflect(App.prototype,"App");var BgGround=function(t){function e(){var e=t.call(this)||this;return e.speed=5,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var e=RES.getRes("ground_png");this.textureWidth=e.textureWidth,this.rowCount=Math.ceil(this.stageW/this.textureWidth)+1,this.bmpArr=[];for(var i=0;i<this.rowCount;i++){var r=this.createBitmapByName("ground2_png");r.x=this.textureWidth*i,r.y=870,this.bmpArr.push(r),this.addChild(r)}},e.prototype.start=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this),this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},e.prototype.enterFrameHandler=function(t){for(var e=0;e<this.rowCount;e++){var i=this.bmpArr[e];i.x-=this.speed,i.x<=-this.textureWidth&&(i.x=this.bmpArr[this.bmpArr.length-1].x+this.textureWidth,this.bmpArr.shift(),this.bmpArr.push(i))}},e.prototype.pause=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);__reflect(BgGround.prototype,"BgGround");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.gravity=1,e.speedY=0,e.jumpvelocity=15,e.scoreFlag=!0,e.startFlag=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){console.log("hello,world")}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.getInstance=function(){return this.ins||(this.ins=new e),this.ins},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){var t=this.createBitmapByName("background2_png");this.addChild(t),t.x=0,t.y=33,this.loadAnimation(this.startAnimation);var e=this.createBitmapByName("space_tip_png");this.addChild(e),e.x=220,e.y=450,this.startButton=e,this.startButton.touchEnabled=!0,this.startButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonClick,this),this.pipes=new Pipe,this.addChild(this.pipes),this.groud=new BgGround,this.groud.start(),this.addChild(this.groud),this.scoreText=new egret.TextField,this.scoreText.text="socore:0",this.scoreText.size=32,this.scoreText.x=420,this.scoreText.y=50,this.addChild(this.scoreText),this.scoreText.visible=!1,this.scoreBord=this.createBitmapByName("scoreboard_png"),this.scoreBord.visible=!1,this.scoreBord.x=100,this.scoreBord.y=300,this.addChild(this.scoreBord),this.resetButton=new egret.Bitmap,this.addChild(this.resetButton),this.resetButton.x=120,this.resetButton.y=720,this.resetButton.width=170,this.resetButton.height=70,this.resetButton.visible=!1,this.resetButton.touchEnabled=!1,this.resetButton.alpha=0,this.resetButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.reStartGame,this),this.nowscoreText=new egret.TextField,this.nowscoreText.text="0",this.nowscoreText.size=50,this.nowscoreText.x=435,this.nowscoreText.y=490,this.nowscoreText.bold=!0,this.nowscoreText.textColor=0,this.addChild(this.nowscoreText),this.nowscoreText.visible=!1,this.histryscoreText=new egret.TextField,this.histryscoreText.text="0",this.histryscoreText.size=50,this.histryscoreText.x=440,this.histryscoreText.y=585,this.histryscoreText.bold=!0,this.histryscoreText.textColor=0,this.addChild(this.histryscoreText),this.histryscoreText.visible=!1;var i=new egret.Shape;i.graphics.beginFill(16777215),i.graphics.drawRect(0,-7,800,40),i.graphics.endFill(),this.addChild(i)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.loadAnimation=function(t){var e=0,i=this,r=function(){e++,2==e&&t.call(i)},s=new egret.URLLoader;s.addEventListener(egret.Event.COMPLETE,function(t){var e=t.currentTarget;this._mcTexture=e.data,r()},this),s.dataFormat=egret.URLLoaderDataFormat.TEXTURE;var o=new egret.URLRequest("resource/assets/animation/plane.png");s.load(o);var s=new egret.URLLoader;s.addEventListener(egret.Event.COMPLETE,function(t){var e=t.currentTarget;this._mcData=JSON.parse(e.data),r()},this),s.dataFormat=egret.URLLoaderDataFormat.TEXT;var o=new egret.URLRequest("resource/assets/animation/plane.json");s.load(o)},e.prototype.startAnimation=function(){var t=new egret.MovieClipDataFactory(this._mcData,this._mcTexture),e=new egret.MovieClip(t.generateMovieClipData("plane"));this.bird=e,this.bird.anchorOffsetX=this.bird.width/2,this.bird.anchorOffsetY=this.bird.height/2,this.addChild(e),e.gotoAndPlay(1,-1),e.x=300,e.y=350,e.addEventListener(egret.Event.COMPLETE,function(t){egret.log("play over!")},this),e.addEventListener(egret.Event.LOOP_COMPLETE,function(t){egret.log("play times:")},this),e.addEventListener(egret.MovieClipEvent.FRAME_LABEL,function(t){egret.log("frameLabel:"+t.frameLabel)},this)},e.prototype.onButtonClick=function(t){this.startGame()},e.prototype.reStartGame=function(){var t=this;this.scoreBord.visible=!1,e.scoreNum=0,this.groud.start(),this.startButton.visible=!0,this.startButton.touchEnabled=!0,this.resetButton.visible=!1,this.resetButton.touchEnabled=!1,this.nowscoreText.visible=!1,this.histryscoreText.visible=!1,this.bird.x=300,this.bird.y=350,this.bird.play(),this.speedY=0,this.pipes.reset(),this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){t.birdFly()},this)},e.prototype.startGame=function(){var t=this;this.playMusic("swooshing_mp3"),this.scoreText.visible=!0,this.startButton.visible=!1,this.startButton.touchEnabled=!1,this.nowscoreText.visible=!1,this.histryscoreText.visible=!1,this.scoreBord.visible=!1,this.startFlag=!0,this.birdFly(),this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this),this.pipes.start(),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){t.birdFly()},this)},e.prototype.enterFrameHandler=function(t){if(this.birdFall(),this.startFlag){var i=this.isCrash();if(i){var r=this.playMusic("hit_mp3");App.soundChannel=r,this.gameOver()}this.changeAngle(),this.scoreText.text="socore:"+e.scoreNum}},e.prototype.birdFall=function(){this.speedY+=this.gravity,this.bird.y<860?this.bird.y+=this.speedY:this.speedY<=0&&(this.bird.y+=this.speedY)},e.prototype.birdFly=function(){this.startFlag&&(this.playMusic("wing_mp3"),this.speedY=-this.jumpvelocity)},e.prototype.isCrash=function(){for(var t=0;t<App.pipeNum;t++){var e=this.pipes.getPipes(t),i=e[0],r=e[1];if(this.hitTestP(i,this.bird))return!0;if(this.hitTestP(r,this.bird))return!0}return this.bird.y<=0||this.bird.y>=850?!0:!1},e.prototype.addSocore=function(){this.scoreFlag&&(e.scoreNum++,this.playMusic("point_mp3"),this.scoreFlag=!1)},e.prototype.changeAngle=function(){this.speedY<=0?this.bird.rotation=-Math.PI/6:this.bird.rotation=Math.PI/6},e.prototype.gameOver=function(){this.playMusic("die_mp3"),this.groud.pause(),this.pipes.pause(),this.startFlag=!1,this.scoreBord.visible=!0,this.resetButton.visible=!0,this.resetButton.touchEnabled=!0,this.nowscoreText.visible=!0,this.nowscoreText.text=e.scoreNum+"",e.scoreNum>=App.hightScore&&(App.hightScore=e.scoreNum),this.histryscoreText.visible=!0,this.histryscoreText.text=App.hightScore+"",this.scoreText.visible=!1,this.scoreText.text="",this.bird.stop()},e.prototype.playMusic=function(t){var e=RES.getRes(t);return e.play(0,1)},e.prototype.hitTestP=function(t,e){var i=t.getBounds(),r=e.getBounds();return i.x=t.x,i.y=t.y,r.x=e.x-45,r.y=e.y-10,i.intersects(r)},e.prototype.getBirdPos=function(){return[this.bird.x,this.bird.y]},e.scoreNum=0,e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Pipe=function(t){function e(){var e=t.call(this)||this;return e.speed=7,e.distanceY=300,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this);var e=RES.getRes("background_png");this.stageW=e.textureWidth,this.stageH=e.textureHeight;var i=RES.getRes("pipedown_png");this.textureWidth=i.textureWidth,this.distance=this.stageW/2,this.bmpArrDown=[],this.bmpArrUp=[];for(var r=0;r<App.pipeNum;r++){var s=this.createBitmapByName("pipedown2_png"),o=this.createBitmapByName("pipeup2_png");s.x=(this.textureWidth+this.distance)*r+this.stageW,s.y=Math.ceil(300*Math.random())-600,this.bmpArrDown.push(s),this.addChild(s),o.x=s.x,o.y=s.y+s.height+this.distanceY,this.bmpArrUp.push(o),this.addChild(o)}},e.prototype.start=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this),this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},e.prototype.enterFrameHandler=function(t){for(var e=0;e<App.pipeNum;e++){var i=this.bmpArrDown[e],r=this.bmpArrUp[e];i.x-=this.speed,r.x-=this.speed,i.x<250&&Main.getInstance().addSocore(),i.x<-this.textureWidth&&(i.x=(this.textureWidth+this.distance)*(App.pipeNum-2)+this.stageW+this.textureWidth,i.y=Math.ceil(300*Math.random())-600,r.x=i.x,r.y=i.y+i.height+this.distanceY,Main.getInstance().scoreFlag=!0)}},e.prototype.pause=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.getPipes=function(t){return[this.bmpArrUp[t],this.bmpArrDown[t]]},e.prototype.reset=function(){Main.getInstance().scoreFlag=!0,this.removeChildren(),this.bmpArrDown=[],this.bmpArrUp=[];for(var t=0;t<App.pipeNum;t++){var e=this.createBitmapByName("pipedown2_png"),i=this.createBitmapByName("pipeup2_png");e.x=(this.textureWidth+this.distance)*t+this.stageW,e.y=Math.ceil(300*Math.random())-600,this.bmpArrDown.push(e),this.addChild(e),i.x=e.x,i.y=e.y+e.height+this.distanceY,this.bmpArrUp.push(i),this.addChild(i)}},e}(egret.DisplayObjectContainer);__reflect(Pipe.prototype,"Pipe");